(()=>{var e={735(e){const t="https://06zyva2dth.execute-api.ap-northeast-1.amazonaws.com";e.exports&&(e.exports={createTicket:async function(e,n){const{subdomain:o,email:a,apiToken:i,groupId:s}=e,{subject:r,body:c,requesterEmail:u,requesterName:d,attachmentTokens:l}=n,m=`https://${o}/api/v2/tickets.json`,g={ticket:{subject:r,comment:{body:c,html_body:c,public:!1},requester:{email:u,name:d}}};s&&(g.ticket.group_id=parseInt(s,10)),l&&l.length>0&&(g.ticket.comment.uploads=l);const f=btoa(`${a}/token:${i}`);try{const e={method:"POST",headers:{"Content-Type":"application/json",Authorization:`Basic ${f}`},body:JSON.stringify(g)};let n=m;n=t,e.headers["X-Target-URL"]=m;const o=await fetch(n,e);if(!o.ok){const e=await o.text();throw new Error(`Zendesk API error (${o.status}): ${e}`)}return await o.json()}catch(e){throw console.error("Error creating Zendesk ticket:",e),e}},addCommentToTicket:async function(e,n,o){const{subdomain:a,email:i,apiToken:s}=e,{body:r,attachmentTokens:c}=o,u=`https://${a}/api/v2/tickets/${n}.json`,d={ticket:{comment:{body:r,html_body:r,public:!1}}};c&&c.length>0&&(d.ticket.comment.uploads=c);const l=btoa(`${i}/token:${s}`);try{const e={method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Basic ${l}`},body:JSON.stringify(d)};let n=u;n=t,e.headers["X-Target-URL"]=u;const o=await fetch(n,e);if(!o.ok){const e=await o.text();throw new Error(`Zendesk API error (${o.status}): ${e}`)}return await o.json()}catch(e){throw console.error("Error adding comment to Zendesk ticket:",e),e}},uploadAttachment:async function(e,n){const{subdomain:o,email:a,apiToken:i}=e,{filename:s,content:r}=n,c=`https://${o}/api/v2/uploads.json?filename=${encodeURIComponent(s)}`,u=btoa(`${a}/token:${i}`);try{let e;if("string"==typeof r){const t=atob(r),n=new Uint8Array(t.length);for(let e=0;e<t.length;e++)n[e]=t.charCodeAt(e);e=n}else e=r;const n={method:"POST",headers:{Authorization:`Basic ${u}`,"Content-Type":"application/binary"},body:e};let o=c;o=t,n.headers["X-Target-URL"]=c;const a=await fetch(o,n);if(!a.ok){const e=await a.text();throw new Error(`Failed to upload attachment (${a.status}): ${e}`)}return(await a.json()).upload.token}catch(e){throw console.error("Error uploading attachment:",e),e}},testConnection:async function(e){const{subdomain:n,email:o,apiToken:a}=e,i=`https://${n}/api/v2/users/me.json`,s=btoa(`${o}/token:${a}`);try{const e={method:"GET",headers:{Authorization:`Basic ${s}`}};let n=i;return n=t,e.headers["X-Target-URL"]=i,(await fetch(n,e)).ok}catch(e){return console.error("Error testing Zendesk connection:",e),!1}},fetchGroups:async function(e){const{subdomain:n,email:o,apiToken:a}=e,i=`https://${n}/api/v2/groups.json`,s=btoa(`${o}/token:${a}`);try{const e={method:"GET",headers:{Authorization:`Basic ${s}`}};let n=i;n=t,e.headers["X-Target-URL"]=i;const o=await fetch(n,e);if(!o.ok)throw new Error(`Failed to fetch groups: ${o.status}`);return(await o.json()).groups||[]}catch(e){throw console.error("Error fetching Zendesk groups:",e),e}}})},869(e){const t="zendeskSubdomain",n="zendeskEmail",o="zendeskApiToken",a="ticketSubjectTemplate",i="addInEnabled",s="conversationTicketMap",r="zendeskGroupId";async function c(){return new Promise(e=>{e({subdomain:Office.context.roamingSettings.get(t)||"",email:Office.context.roamingSettings.get(n)||"",apiToken:Office.context.roamingSettings.get(o)||"",subjectTemplate:Office.context.roamingSettings.get(a)||"Support Request from Outlook",enabled:!1!==Office.context.roamingSettings.get(i),groupId:Office.context.roamingSettings.get(r)||""})})}e.exports&&(e.exports={saveSettings:async function(e){return new Promise((s,c)=>{Office.context.roamingSettings.set(t,e.subdomain||""),Office.context.roamingSettings.set(n,e.email||""),Office.context.roamingSettings.set(o,e.apiToken||""),Office.context.roamingSettings.set(a,e.subjectTemplate||"Support Request from Outlook"),Office.context.roamingSettings.set(i,!1!==e.enabled),Office.context.roamingSettings.set(r,e.groupId||""),Office.context.roamingSettings.saveAsync(e=>{e.status===Office.AsyncResultStatus.Succeeded?s():c(new Error("Failed to save settings: "+e.error.message))})})},loadSettings:c,isConfigured:async function(){const e=await c();return!!(e.subdomain&&e.email&&e.apiToken)},clearSettings:async function(){return new Promise((e,s)=>{Office.context.roamingSettings.remove(t),Office.context.roamingSettings.remove(n),Office.context.roamingSettings.remove(o),Office.context.roamingSettings.remove(a),Office.context.roamingSettings.remove(i),Office.context.roamingSettings.saveAsync(t=>{t.status===Office.AsyncResultStatus.Succeeded?e():s(new Error("Failed to clear settings: "+t.error.message))})})},saveConversationTicketMapping:async function(e,t){return new Promise((n,o)=>{const a=Office.context.roamingSettings.get(s)||{};a[e]=t,Office.context.roamingSettings.set(s,a),Office.context.roamingSettings.saveAsync(e=>{e.status===Office.AsyncResultStatus.Succeeded?n():o(new Error("Failed to save conversation mapping: "+e.error.message))})})},getTicketForConversation:async function(e){return new Promise(t=>{t((Office.context.roamingSettings.get(s)||{})[e]||null)})},clearConversationMappings:async function(){return new Promise((e,t)=>{Office.context.roamingSettings.remove(s),Office.context.roamingSettings.saveAsync(n=>{n.status===Office.AsyncResultStatus.Succeeded?e():t(new Error("Failed to clear mappings: "+n.error.message))})})}})}},t={};function n(o){var a=t[o];if(void 0!==a)return a.exports;var i=t[o]={exports:{}};return e[o](i,i.exports,n),i.exports}const o=n(869),a=n(735);async function i(){const e=document.getElementById("saveButton"),t=e.textContent;try{e.disabled=!0,e.textContent="Saving...";const t=document.getElementById("subdomain").value.trim(),n=document.getElementById("email").value.trim(),a=document.getElementById("apiToken").value.trim(),i=document.getElementById("subjectTemplate").value.trim()||"Support Request from Outlook",s=document.getElementById("enabled").checked,r=document.getElementById("groupId").value.trim();if(!t||!n||!a)return void u("Please fill in all required fields","error");if(!t.includes(".zendesk.com"))return void u("Subdomain should be in format: yourcompany.zendesk.com","error");await o.saveSettings({subdomain:t,email:n,apiToken:a,subjectTemplate:i,enabled:s,groupId:r}),u("Configuration saved successfully!","success")}catch(e){console.error("Error saving configuration:",e),u("Error saving configuration: "+e.message,"error")}finally{e.disabled=!1,e.textContent=t}}async function s(){const e=document.getElementById("testButton"),t=e.textContent;try{e.disabled=!0,e.textContent="Testing...";const t=document.getElementById("subdomain").value.trim(),n=document.getElementById("email").value.trim(),o=document.getElementById("apiToken").value.trim();if(!t||!n||!o)return void u("Please fill in all fields before testing","error");if(!t.includes(".zendesk.com"))return void u("Subdomain should be in format: yourcompany.zendesk.com","error");await a.testConnection({subdomain:t,email:n,apiToken:o})?(u("Connection successful! Your credentials are valid.","success"),setTimeout(()=>{c()},500)):u("Connection failed. Please check your credentials.","error")}catch(e){console.error("Error testing connection:",e),u("Connection test failed: "+e.message,"error")}finally{e.disabled=!1,e.textContent=t}}async function r(){const e=document.getElementById("clearMappingsButton"),t=e.textContent;try{e.disabled=!0,e.textContent="Clearing...",await o.clearConversationMappings(),u("Thread mappings cleared successfully! New emails will create new tickets.","success")}catch(e){console.error("Error clearing mappings:",e),u("Error clearing mappings: "+e.message,"error")}finally{e.disabled=!1,e.textContent=t}}async function c(){const e=document.getElementById("loadGroupsButton"),t=e.textContent,n=document.getElementById("groupId");try{e.disabled=!0,e.textContent="Loading...",n.disabled=!0;const t=document.getElementById("subdomain").value.trim(),o=document.getElementById("email").value.trim(),i=document.getElementById("apiToken").value.trim();if(!t||!o||!i)return void u("Please fill in credentials before loading groups","error");const s=await a.fetchGroups({subdomain:t,email:o,apiToken:i});n.innerHTML='<option value="">-- No Group Assignment --</option>',0===s.length?u("No groups found in your Zendesk account","info"):(s.forEach(e=>{const t=document.createElement("option");t.value=e.id,t.textContent=e.name,n.appendChild(t)}),u(`Loaded ${s.length} group(s) successfully!`,"success"))}catch(e){console.error("Error loading groups:",e),u("Failed to load groups: "+e.message,"error")}finally{e.disabled=!1,e.textContent=t,n.disabled=!1}}function u(e,t){const n=document.getElementById("statusMessage");n.textContent=e,n.className=`status-message ${t}`,n.classList.remove("hidden"),setTimeout(()=>{n.classList.add("hidden")},5e3)}Office.onReady(e=>{e.host===Office.HostType.Outlook&&(document.getElementById("saveButton").onclick=i,document.getElementById("testButton").onclick=s,document.getElementById("clearMappingsButton").onclick=r,document.getElementById("loadGroupsButton").onclick=c,async function(){try{const e=await o.loadSettings();if(document.getElementById("subdomain").value=e.subdomain||"",document.getElementById("email").value=e.email||"",document.getElementById("apiToken").value=e.apiToken||"",document.getElementById("subjectTemplate").value=e.subjectTemplate||"Support Request from Outlook",document.getElementById("enabled").checked=!1!==e.enabled,e.groupId){const t=document.getElementById("groupId");let n=!1;for(let o=0;o<t.options.length;o++)if(t.options[o].value===e.groupId){n=!0;break}if(!n){const n=document.createElement("option");n.value=e.groupId,n.textContent=`Group ID: ${e.groupId}`,t.appendChild(n)}t.value=e.groupId}e.subdomain&&e.email&&e.apiToken&&u("Configuration loaded successfully","success")}catch(e){console.error("Error loading configuration:",e),u("Error loading configuration: "+e.message,"error")}}())})})();
//# sourceMappingURL=taskpane.js.map